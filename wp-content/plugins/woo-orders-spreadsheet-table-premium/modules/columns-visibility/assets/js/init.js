jQuery(document).ready(function(){if("undefined"==typeof hot||!jQuery(".modal-columns-visibility").length)return!0;var e=hot.getSettings().contextMenu;void 0===e.items&&(e.items={}),e.items.wpse_hide_column={name:vgse_editor_settings.texts.hide_column,hidden:function(){var e;return!hot.getSelected()||(e=hot.colToProp(hot.getSelected()[0][1]),(e=vgse_editor_settings.final_spreadsheet_columns_settings[e])&&!e.allow_to_hide)},callback:function(e,t,s){if(beGetModifiedItems().length)alert(vgse_editor_settings.texts.save_changes_before_remove_column);else{let l=Alpine.$data(document.querySelector('[x-data="vgseColumnsManager"]'));t.forEach(function(e){for(var t=(e.start.col>e.end.col?e.end:e.start).col,s=(e.start.col>e.end.col?e.start:e.end).col,i=[],n=t;n<=s;n++)i.push(n);i.forEach(function(e){e=hot.colToProp(e);l.deactivateColumn(e)})}),l.saveChangesInServer=!0,l.columnsVisibilityUpdateHOT(null,null,null,"hardUpdate"),notification({mensaje:vgse_editor_settings.texts.column_removed,tipo:"success",tiempo:4e4})}}},e.items.wpse_open_columns_visibility={name:vgse_editor_settings.texts.open_columns_visibility,callback:function(e,t,s){jQuery(".modal-columns-visibility").remodal().open()}},hot.updateSettings({contextMenu:e})}),document.addEventListener("alpine:init",()=>{Alpine.data("vgseColumnsManager",()=>({nonce:vgseColumnsManager.nonce,prepared_columns:vgseColumnsManager.prepared_columns,always_visible_columns:vgseColumnsManager.not_allowed_columns,default_column_data:vgseColumnsManager.default_column_data,enabledSearchTerm:"",disabledSearchTerm:"",enabledBulkAction:"",disabledBulkAction:"",showBulkActions:!1,bulkToggleClicked:null,saveChangesInServer:!1,hasInitialized:!1,init(){this.addDefaultColumnsValues(this.prepared_columns,this.default_column_data),jQuery(document).on("opened",".modal-columns-visibility",()=>{this.initUi(),this.equalizeHeightInLists()}),jQuery("body").on("click",".wpse-toggle-head",e=>{jQuery(e.target).next(".wpse-toggle-content").find(".modal-columns-visibility").length&&(this.initUi(),this.equalizeHeightInLists())}),this.initUi(),this.$watch("enabledSearchTerm",()=>{setTimeout(()=>{this.equalizeHeightInLists()},200)}),this.$watch("disabledSearchTerm",()=>{setTimeout(()=>{this.equalizeHeightInLists()},200)})},addDefaultColumnsValues(e,t){for(var s in e)e.hasOwnProperty(s)&&(e[s]={...t,...e[s]})},getEnabledColumns(){return Object.values(this.prepared_columns).filter(e=>"enabled"===e.status).sort((e,t)=>e.order-t.order)},getDisabledColumns(){return Object.values(this.prepared_columns).filter(e=>"disabled"===e.status).sort((e,t)=>e.order-t.order)},getFilteredEnabledColumns(){if(!this.enabledSearchTerm)return this.getEnabledColumns();let s=this.enabledSearchTerm;if(s.startsWith("/"))try{let t=new RegExp(s.slice(1),"i");return this.getEnabledColumns().filter(e=>t.test(e.title))}catch(e){}return this.getEnabledColumns().filter(e=>e.title.toLowerCase().includes(s.toLowerCase()))},getFilteredDisabledColumns(){if(!this.disabledSearchTerm)return this.getDisabledColumns();let s=this.disabledSearchTerm;if(s.startsWith("/"))try{let t=new RegExp(s.slice(1),"i");return this.getDisabledColumns().filter(e=>t.test(e.title))}catch(e){}return this.getDisabledColumns().filter(e=>e.title.toLowerCase().includes(s.toLowerCase()))},handleBulkAction(e){let s="enabled"===e?this.enabledBulkAction:this.disabledBulkAction;var t="enabled"===e?this.getFilteredEnabledColumns():this.getFilteredDisabledColumns();s&&0!==t.length&&("enable"===s?t.forEach(e=>{this.enableColumn(e.key,!0)}):"disable"===s?t.forEach(e=>{this.deactivateColumn(e.key,!0)}):"sort_alphabetically_asc"===s||"sort_alphabetically_desc"===s?t.sort((e,t)=>{e=e.title.localeCompare(t.title);return"sort_alphabetically_asc"===s?e:-e}).map(e=>e.key).forEach((e,t)=>{this.prepared_columns[e]&&(this.prepared_columns[e].order=t)}):"delete"===s&&(t=t.map(e=>e.key),this.deleteColumns(t)),"enabled"===e?this.enabledBulkAction="":this.disabledBulkAction="")},equalizeHeightInLists(){jQuery("#vgse-columns-enabled,#vgse-columns-disabled").css("height","");var e=jQuery("#vgse-columns-enabled").height(),t=jQuery("#vgse-columns-disabled").height(),e=t<e?e:t;0<e&&jQuery("#vgse-columns-enabled,#vgse-columns-disabled").height(e)},applyColumnChangesToHot(e,s,i){var n,t,l,a,o;"undefined"!=typeof hot&&(e=e||hot.getSettings().columns,s=s||vgse_editor_settings.colHeaders,i=i||vgse_editor_settings.colWidths,n=[],e.forEach(function(e,t){e.vgOriginalIndex=t,n[e.data]=e},this),vgse_editor_settings.columnsFormat.wpseBulkSelector&&-1===this.always_visible_columns.indexOf("wpseBulkSelector")&&(this.always_visible_columns=["wpseBulkSelector"].concat(this.always_visible_columns)),t=[],this.getEnabledColumns().forEach(e=>{t.push(e.key)}),t=this.always_visible_columns.concat(t),l=[],a=[],o=[],t.forEach(function(e,t){n[e]?(l.push(n[e]),a.push(s[e]),o.push(i[e])):vgse_editor_settings&&vgse_editor_settings.columnsFormat[e]&&(l.push(vgse_editor_settings.columnsFormat[e]),a.push(vgse_editor_settings.colHeaders[e]),o.push(vgse_editor_settings.colWidths[e]))},this),hot.updateSettings({columns:l,colHeaders:a,colWidths:o}))},finishApplyingChangesToHot(){var e=$('[data-remodal-id="modal-columns-visibility"]').remodal();return loading_ajax(!1),e&&"opened"===e.getState()&&e.close(),!1},columnsVisibilityUpdateHOT(e,t,s,i){var n,l,a,o=$('[x-data="vgseColumnsManager"] form');return this.getEnabledColumns().length&&(n=o.find(".columns-enabled li .fa-refresh").parent(),l=!1,o.find('input[name="wpse_auto_reload_after_saving"]').val()&&(l=!0),n.length&&(a=[],n.find(".column-title").each(function(){a.push(jQuery(this).text().trim())}),o=vgse_editor_settings.texts.confirm_column_reload_page.replace("{columns}",a.join(", ")),confirm(o))&&(l=this.saveChangesInServer=!0,loading_ajax(!0)),this.applyColumnChangesToHot(e,t,s),this.saveChangesInServer)&&"softUpdate"!==i&&this.saveChanges(l),this.finishApplyingChangesToHot()},getColumnsDataToSave(){var e=this.getEnabledColumns(),t=this.getDisabledColumns();let s={columns:e.map(e=>e.key),columns_names:e.map(e=>e.title),disallowed_columns:t.map(e=>e.key),disallowed_columns_names:t.map(e=>e.title),column_settings:{}};return Object.keys(this.prepared_columns).forEach(e=>{let t={...this.prepared_columns[e]};delete t.title,delete t.key,delete t.status,delete t.order,delete t.allow_custom_format,delete t.show_column_settings,delete t.allow_readonly_option_in_columns_manager,delete t.allow_role_restrictions_in_columns_manager,Object.keys(t).forEach(e=>{t[e]===this.default_column_data[e]&&delete t[e]}),s.column_settings[e]=t}),s},saveChanges(s){var i=$('[x-data="vgseColumnsManager"] form'),e=this.getColumnsDataToSave(),t=i.find("input,select,textarea").filter(function(){return!jQuery(this).parents(".vgse-sorter-section").length}).serializeArray();t.push({name:"extra_data",value:JSON.stringify(e)}),s&&loading_ajax(!0),jQuery.post(i.attr("action"),t,function(e){var t=i.data("callback");t&&vgseExecuteFunctionByName(t,window,{response:e,form:i}),s&&window.location.href.indexOf("wpse_no_reload=1")<0&&window.location.reload()})},itemsMoved(){var e=jQuery('[x-data="vgseColumnsManager"');e.find(".columns-enabled li input.js-column-key").each((e,t)=>{this.prepared_columns[jQuery(t).val()].order=e,this.prepared_columns[jQuery(t).val()].status="enabled"}),e.find(".columns-disabled li input.js-column-key").each((e,t)=>{this.prepared_columns[jQuery(t).val()].order=e,this.prepared_columns[jQuery(t).val()].status="disabled"}),window.vgseColumnsVisibilityUsed=!0},initializeSortable(){var e=document.getElementById("vgse-columns-enabled"),t=document.getElementById("vgse-columns-disabled");if(!e||!t)return!0;window.enabledSortable=Sortable.create(e,{group:"vgseColumns",animation:100,scrollSensitivity:60,onSort:e=>{_throttle(()=>{this.itemsMoved()},2e3)()}}),window.disabledSortable=Sortable.create(t,{group:{name:"vgseColumns"},scrollSensitivity:60,animation:100})},submitForm(){var e=this.columnsVisibilityUpdateHOT(null,null,null,"hardUpdate");return"boolean"==typeof e&&e},restoreDeletedColumns(){jQuery.post(vgse_global_data.ajax_url,{action:"vgse_restore_columns",nonce:jQuery('.modal-columns-visibility input[name="wpsecv_nonce"]').val(),post_type:jQuery('.modal-columns-visibility input[name="wpsecv_post_type"]').val()},function(e){e.success?alert(e.data.message):notification({mensaje:e.data.message,tipo:"error",tiempo:3e4})})},deactivateColumn(e,t){if(!t){if(window.hot&&!window.wpseExecutionActionOnSimilarColumns)if(beGetModifiedItems().length)return alert(vgse_editor_settings.texts.save_changes_before_remove_column),!0;this.maybeApplyActionToSimilarColumns(e,"deactivateColumn")}this.prepared_columns[e].status="disabled",this.prepared_columns[e].order=this.getDisabledColumns().length},enableColumn(e,t){t||this.maybeApplyActionToSimilarColumns(e,"enableColumn"),this.prepared_columns[e].status="enabled",this.prepared_columns[e].order=this.getEnabledColumns().length},maybeApplyActionToSimilarColumns(e,s){if(window.wpseExecutionActionOnSimilarColumns)return!0;var i=this.prepared_columns[e].title;if(i&&!(i.length<2)){var n=i.replace(/(\d+)/g,"1").replace(": 1: ",":").split("1"),l=[],a=[];if(1===n.length)return!0;if(n=[n[0],""],Object.values(this.prepared_columns).forEach(e=>{var t=e.title,s=t.replace(/(\d+)/g,"1").replace(": 1: ",":").split("1");s.push(""),1<vgseCountMatchingElements(n,s)&&t!==i&&(l.push(e.key),a.push(t))}),!l.length)return!0;window.wpseExecutionActionOnSimilarColumns=!0;e=4<l.length?vgse_editor_settings.texts.clicks_that_will_be_saved.replace("{clicks_count}",l.length):"",e=(e+="\n"+a.join("\n"),vgse_editor_settings.texts.apply_action_to_similar_columns.replace("{columns}",e));confirm(e)&&("deleteColumns"===s?this[s](l):l.forEach((e,t)=>{this[s](e)})),window.wpseExecutionActionOnSimilarColumns=!1}},deleteColumn(e){if(window.hot&&beGetModifiedItems().length)return alert(vgse_editor_settings.texts.save_changes_before_remove_column),!0;this.maybeApplyActionToSimilarColumns(e,"deleteColumns"),this.deleteColumns([e])},deleteColumns(e){return e.forEach(e=>{delete this.prepared_columns[e]}),jQuery.post(vgse_global_data.ajax_url,{action:"vgse_remove_column",nonce:jQuery('.modal-columns-visibility input[name="wpsecv_nonce"]').val(),post_type:jQuery('.modal-columns-visibility input[name="wpsecv_post_type"]').val(),column_key:e},function(e){e.success||notification({mensaje:e.data.message,tipo:"error",tiempo:3e4})}),!1},initUi(){if(this.hasInitialized)return!0;this.hasInitialized=!0,this.equalizeHeightInLists(),this.initializeSortable(),jQuery("body").on("keypress",".modal-columns-visibility input",function(e){if(13==e.keyCode)return e.preventDefault(),!1})}}))});