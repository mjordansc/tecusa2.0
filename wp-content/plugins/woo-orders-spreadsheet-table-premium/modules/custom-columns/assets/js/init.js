jQuery(document).ready(function(){if("undefined"==typeof hot||!jQuery(".modal-columns-visibility").length||!vgse_editor_settings.is_administrator)return!0;var e=hot.getSettings().contextMenu;void 0===e.items&&(e.items={}),e.items.wpse_rename_meta_key={name:vgse_editor_settings.texts.edit_meta_key,hidden:function(){var e;return!hot.getSelected()||(e=hot.colToProp(hot.getSelected()[0][1]),e=vgse_editor_settings.final_spreadsheet_columns_settings[e],!vgse_editor_settings.is_administrator)||!e||"meta_data"!==e.data_type||e.serialized_field_settings},callback:function(e,t,s){var a,t=hot.colToProp(t[0].start.col);t=t,(a=prompt(vgse_editor_settings.texts.edit_meta_key,t))&&a!==t?(loading_ajax(!0),jQuery.post(vgse_global_data.ajax_url,{action:"vgse_rename_meta_key",nonce:jQuery("#vgse-wrapper").data("nonce"),post_type:vgse_editor_settings.post_type,old_column_key:t,new_column_key:a},function(e){var t;loading_ajax(!1),e.success?(notification({mensaje:e.data.message}),t=vgse_editor_settings.texts.confirm_column_reload_page.replace("{columns}",e.data.key),confirm(t)&&(window.location.href=jQuery(".wpse-scan-db-link").attr("href")+"&wpse_dont_increase_limit=1")):notification({mensaje:e.data.message,tipo:"error",tiempo:6e4})})):notification({mensaje:vgse_editor_settings.texts.new_value_empty_or_equal,tipo:"error",tiempo:1e4})}},e.items.wpse_delete_meta_key={name:vgse_editor_settings.texts.delete_meta_key,hidden:function(){var e;return!hot.getSelected()||(e=hot.colToProp(hot.getSelected()[0][1]),e=vgse_editor_settings.final_spreadsheet_columns_settings[e],!vgse_editor_settings.is_administrator)||!e||"meta_data"!==e.data_type||e.serialized_field_settings||!e.allow_to_hide},callback:function(e,t,s){if(!confirm(vgse_editor_settings.texts.delete_meta_key_confirmation))return!0;var i=[];t.forEach(function(e){for(var t=(e.start.col>e.end.col?e.end:e.start).col,s=(e.start.col>e.end.col?e.start:e.end).col,a=t;a<=s;a++)i.push(hot.colToProp(a))}),loading_ajax(!0),jQuery.post(vgse_global_data.ajax_url,{action:"vgse_delete_meta_key",nonce:jQuery("#vgse-wrapper").data("nonce"),post_type:vgse_editor_settings.post_type,column_key:i},function(e){var t;loading_ajax(!1),e.success?(notification({mensaje:e.data.message}),(t=Alpine.$data(document.querySelector('[x-data="vgseColumnsManager"]'))).deleteColumns(i),t.columnsVisibilityUpdateHOT(null,null,null,"softUpdate")):notification({mensaje:e.data.message,tipo:"error",tiempo:6e4})})}},e.items.wpse_delete_serialized_meta_key={name:vgse_editor_settings.texts.delete_serialized_meta_key,hidden:function(){var e;return!(hot.getSelected()&&(e=hot.colToProp(hot.getSelected()[0][1]),e=vgse_editor_settings.final_spreadsheet_columns_settings[e],vgse_editor_settings.is_administrator)&&e&&"meta_data"===e.data_type&&e.serialized_field_original_key&&e.allow_to_hide)},callback:function(e,t,s){if(!confirm(vgse_editor_settings.texts.delete_serialized_meta_key_confirmation))return!0;var t=hot.colToProp(t[0].start.col),i=vgse_editor_settings.final_spreadsheet_columns_settings[t].serialized_field_original_key;loading_ajax(!0),jQuery.post(vgse_global_data.ajax_url,{action:"vgse_delete_meta_key",nonce:jQuery("#vgse-wrapper").data("nonce"),post_type:vgse_editor_settings.post_type,column_key:i},function(e){if(loading_ajax(!1),e.success){notification({mensaje:e.data.message});var t,s=[];for(t in vgse_editor_settings.final_spreadsheet_columns_settings)Object.hasOwnProperty.call(vgse_editor_settings.final_spreadsheet_columns_settings,t)&&vgse_editor_settings.final_spreadsheet_columns_settings[t].serialized_field_original_key===i&&s.push(t);var a=Alpine.$data(document.querySelector('[x-data="vgseColumnsManager"]'));a.deleteColumns(s),a.columnsVisibilityUpdateHOT(null,null,null,"softUpdate")}else notification({mensaje:e.data.message,tipo:"error",tiempo:6e4})})}},hot.updateSettings({contextMenu:e})}),jQuery(document).ready(function(){vgseInitLazySelects(vg_sheet_editor_custom_columns.lazy_loaded_select_options)}),document.addEventListener("alpine:init",()=>{Alpine.data("vgseCustomColumnForm",()=>({columns:vg_sheet_editor_custom_columns.custom_columns,defaultColumn:vg_sheet_editor_custom_columns.default_column_values,app:document.querySelector('[x-data="vgseCustomColumnForm"]'),visibleColumns:{},addColumn(){this.columns.push(this.defaultColumn),this.visibleColumns[this.columns.length-1]=!0},initSelect2(e){vgseInitSelect2(e),setTimeout(()=>{$(e).trigger("change")},250),this.fixSelect2(e)},syncSelectToProp(e){$(e).on("change",function(){$(this).get(0).dispatchEvent(new Event("input"))})},fixSelect2(t){t.classList.add("wpse-select2-fix");let s=$(t);var e=t.getAttribute("data-full-model-path");let a=e.replace("[",".").replace("]","");this.$watch(e,e=>{s.val(e).trigger("change")}),s.on("select2:select select2:unselect",e=>{e=Array.from(e.target.selectedOptions).map(e=>e.value);t.hasAttribute("multiple")||(e=e.length?e[0]:null),this.setToValue(Alpine.$data(this.app),e,a)})},setToValue(e,t,s){var a;for(s=s.split("."),a=0;a<s.length-1;a++)e=e[$.isNumeric(s[a])?parseInt(s[a]):s[a]];e[s[a]]=t},save(){loading_ajax(!0),fetch(vgse_global_data.ajax_url,{method:"POST",body:new URLSearchParams({action:"vgse_save_columns",nonce:vg_sheet_editor_custom_columns.nonce,columns:JSON.stringify(this.columns)})}).then(e=>e.json()).then(e=>{loading_ajax(!1),e.success?notification({mensaje:e.data.message}):notification({mensaje:e.data.message,tipo:"error",tiempo:6e4})}).catch(e=>{loading_ajax(!1)})},removeColumn(e){this.columns.splice(e,1),this.visibleColumns[e]&&delete this.visibleColumns[e]}}))});