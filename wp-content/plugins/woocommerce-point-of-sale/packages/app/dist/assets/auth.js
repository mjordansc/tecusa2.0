import{c as x,g as w,b,u as E,a as D,i as f,d as v,e as H,f as L,h as I}from"../index.js";var S={exports:{}},l={exports:{}},m;function g(){return m||(m=1,function(u){(function(d){var i=-1,n={onVisible:function(e){var r=n.isSupported();if(!r||!n.hidden())return e(),r;var s=n.change(function(o,t){n.hidden()||(n.unbind(s),e())});return s},change:function(e){if(!n.isSupported())return!1;i+=1;var r=i;return n._callbacks[r]=e,n._listen(),r},unbind:function(e){delete n._callbacks[e]},afterPrerendering:function(e){var r=n.isSupported(),s="prerender";if(!r||s!=n.state())return e(),r;var o=n.change(function(t,a){s!=a&&(n.unbind(o),e())});return o},hidden:function(){return!!(n._doc.hidden||n._doc.webkitHidden)},state:function(){return n._doc.visibilityState||n._doc.webkitVisibilityState||"visible"},isSupported:function(){return n._doc.hidden!==void 0||n._doc.webkitHidden!==void 0},_doc:document||{},_callbacks:{},_change:function(e){var r=n.state();for(var s in n._callbacks)n._callbacks[s].call(n._doc,e,r)},_listen:function(){if(!n._init){var e="visibilitychange";n._doc.webkitVisibilityState&&(e="webkit"+e);var r=function(){n._change.apply(n,arguments)};n._doc.addEventListener?n._doc.addEventListener(e,r):n._doc.attachEvent(e,r),n._init=!0}}};u.exports?u.exports=n:d.Visibility=n})(x)}(l)),l.exports}(function(u){(function(d){var i=-1,n=function(e){return e.every=function(r,s,o){e._time(),o||(o=s,s=null),i+=1;var t=i;return e._timers[t]={visible:r,hidden:s,callback:o},e._run(t,!1),e.isSupported()&&e._listen(),t},e.stop=function(r){return e._timers[r]?(e._stop(r),delete e._timers[r],!0):!1},e._timers={},e._time=function(){e._timed||(e._timed=!0,e._wasHidden=e.hidden(),e.change(function(){e._stopRun(),e._wasHidden=e.hidden()}))},e._run=function(r,s){var o,t=e._timers[r];if(e.hidden()){if(t.hidden===null)return;o=t.hidden}else o=t.visible;var a=function(){t.last=new Date,t.callback.call(d)};if(s){var _=new Date,c=_-t.last;o>c?t.delay=setTimeout(function(){t.id=setInterval(a,o),a()},o-c):(t.id=setInterval(a,o),a())}else t.id=setInterval(a,o)},e._stop=function(r){var s=e._timers[r];clearInterval(s.id),clearTimeout(s.delay),delete s.id,delete s.delay},e._stopRun=function(r){var s=e.hidden(),o=e._wasHidden;if(s&&!o||!s&&o)for(var t in e._timers)e._stop(t),e._run(t,!s)},e};u.exports?u.exports=n(g()):n(d.Visibility||g())})(window)})(S);var R=S.exports,T=R;const h=w(T),C=b(({router:u,store:d})=>{const i=E(d),n=D();i.setUser(),i.setNonces(),n.initSession();const e=()=>{const t=i.getCurrentUserMetaData("wc_pos_assigned_outlets")||[],a=I("id");return t.includes(a)},r=()=>n.isActive&&n.open_last!==i.user.id,s=()=>!n.hasStarted||n.hasEnded||n.isLocked;if(u.beforeEach((t,a)=>{if(a.name==="error-reload-register")return!1;if(!e()){const _=["error-unauthorized","login"];return t.name&&!_.includes(t.name)?{name:"error-unauthorized"}:!0}return s()?t.name!=="login"?{name:"login"}:!0:r()?t.name!=="error-register-in-use"?{name:"error-register-in-use"}:!0:t.name==="dining"&&!f("dining")||t.name==="shipping"&&!f("shipping")||t.name==="refund"&&!f("refunds")||t.name==="coupon"&&!f("coupons")||t.name==="discount"&&!f("discounts")?{name:"error-forbidden",path:t.name}:!0}),n.$subscribe((t,a)=>{a.locked&&u.push({name:"login"})}),v("pos","auto_logout",0)&&h.isSupported()){const t=v("pos","auto_logout")*60*1e3;let a;h.change((_,c)=>{c==="hidden"?a=setTimeout(()=>{H("set_session_lock",{register_id:String(L("id")),lock:"1"}).then(p=>{if(p.ok){const k=p.body;n.initSession(k)}})},t):c==="visible"&&clearTimeout(a)})}});export{C as default};
