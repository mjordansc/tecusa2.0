function vgseWcRegularPriceDecreaseNumberFormula(e){var t=vgseGenerateDecreaseFormula(e);return!!t&&t.replace("..",".").replace(/\$current_value\$/g,"$_regular_price$")}function vgseWcRegularPriceDecreasePercentageFormula(e){var t=vgseGenerateDecreasePercentageFormula(e);return!!t&&t.replace("..",".").replace(/\$current_value\$/g,"$_regular_price$")}jQuery(document).ready(function(){jQuery(document).on("opened",".remodal.custom-modal-editor",function(){var e=window.vgseWCAttsCurrent;if(!e||"vgse_save_download_files"!==e.modalSettings.edit_modal_save_action)return!0;jQuery(".remodal.custom-modal-editor .vgse-copy-files-from-product-wrapper").remove()}),jQuery(document).on("opened",".remodal.custom-modal-editor",function(){var t=window.vgseWCAttsCurrent;if(!t||"vgse_save_download_files"!==t.modalSettings.edit_modal_save_action)return!0;setTimeout(function(){$modal=jQuery(".remodal.custom-modal-editor");var e=$modal.find(".vgse-copy-files-from-product");$modal.find(".vgse-copy-files-from-product-trigger").on("click",function(){if(!e.val())return!0;loading_ajax({estado:!0}),jQuery.get(vgse_global_data.ajax_url,{nonce:e.data("nonce"),product_id:e.val(),action:"vgse_wc_get_downloadable_files"},function(e){e.success?initHandsontableForPopup(e.data,t.modalSettings):notification({mensaje:e.data.message,tipo:"error",tiempo:3e4}),loading_ajax({estado:!1})})})},400)})}),jQuery(document).ready(function(){"undefined"!=typeof vgseHooks&&vgseHooks().addFilter("vgSheetEditor_save_precheckErrors","vg_sheet_editor",function(e,t){if("product"===vgse_editor_settings.post_type&&hot.propToCol("post_parent")){var a=hot.getDataAtProp("ID"),r=[];t.forEach(function(e){if("product_variation"===e.post_type){var t=a.indexOf(parseInt(e.ID));hot.getDataAtRowProp(t,"post_parent")||r.push(e.ID)}}),r.length&&e.push(vgse_editor_settings.texts.variation_rows_missing_parent.replace("{variation_ids}",r.join(", ")))}return e}),jQuery("body").on("change",'input[name="copy_individual_variations"]',function(e){var t=jQuery(".vgse-copy-variation-from-product").val();jQuery(this).is(":checked")&&t&&(loading_ajax(!0),jQuery(".individual-variations-select").empty(),jQuery(".individual-variations-selector-wrapper").show(),jQuery.get(vgse_global_data.ajax_url,{action:"vgse_get_product_variations",nonce:jQuery(".remodal-bg").data("nonce"),product_id:t},function(e){loading_ajax(!1),e.success?e.data.length?e.data.forEach(function(e){jQuery(".individual-variations-select").append('<option value="'+e.ID+'">'+e.post_title+"</option>")}):alert(vgse_editor_settings.texts.product_without_variations):alert(e.data.message),vgseInitSelect2(jQuery(".individual-variations-select"))}))}),jQuery("body").on("change",".vgse-copy-variation-from-product",function(e){var t=jQuery(this).val(),a=jQuery(".link-variations-attributes, .link-variations-number");t?(a.parents("li").hide(),jQuery(".individual-variations-wrapper").show()):(a.parents("li").show(),jQuery(".individual-variations-wrapper").hide())}),jQuery("body").on("change",".link-variations-attributes",function(e){var t=jQuery(".link-variations-number");jQuery(this).is(":checked")?t.parents("li").hide():t.parents("li").show()}),jQuery("body").on("submit",".create-variation-modal form",function(e){var i=jQuery(this),o=jQuery(".vgse-variations-tool:visible");if("search"===i.find('select[name="vgse_variation_manager_source"]').val()&&!i.find('input[name="use_search_query"]:checked').length)return i.find('input[name="use_search_query"]').css("border","1px solid red"),!0;if(i.find('input[name="wpse_job_id"]').val(vgseGuidGenerator()),"individual"===o.find('select[name="vgse_variation_manager_source"]').val()&&(2<o.find(".individual-product-selector").val().length||"copy"===o.find('input[name="vgse_variation_tool"]').val())){o.find('select[name="vgse_variation_manager_source"]').val("search");var n=jQuery("body").data("be-filters"),t=[];o.find(".individual-product-selector").val().forEach(function(e){t.push(e.split("--")[1])}),jQuery("body").data("be-filters",{post__in:t.join(",")});var s=t.length,d=!0}else s=jQuery(".be-total-rows").text().match(/\d+/g).map(Number),d=!1;o.data("isPaginatedIndividualProductsOperation",d),"search"!==o.find('select[name="vgse_variation_manager_source"]').val()&&!i.find('input[name="use_search_query"]:checked').length||"function"!=typeof beGetRowsFilters||i.find('input[name="filters"]').val(beGetRowsFilters());var a=i.find("input,select,textarea").filter(function(){return jQuery(this).parents(".vgse-variations-tool").length&&jQuery(this).parents(".vgse-variations-tool").is(":visible")||!jQuery(this).parents(".vgse-variations-tool").length}).serializeArray();if("search"===o.find('select[name="vgse_variation_manager_source"]').val()||i.find('input[name="use_search_query"]:checked').length||"copy"===o.find('input[name="vgse_variation_tool"]').val()){loading_ajax({estado:!1});var c=o.find(".response");c.before('<div id="be-variations-nanobar-container" />');var r={classname:"be-progress-bar",target:document.getElementById("be-variations-nanobar-container")},l=new Nanobar(r);l.go(1);var u=vgse_editor_settings.save_posts_per_page/2;u<1&&(u=1);var v="copy"===o.find('input[name="vgse_variation_tool"]').val()?vgse_editor_settings.texts.paged_copy_variations_preparation:vgse_editor_settings.texts.paged_batch_saved;if("copy"===o.find('input[name="vgse_variation_tool"]').val()){var p=(p=v.replace("{updated}",0)).replace("{total}",s);jQuery(c).empty().append("<p>"+p+"</p>")}var _=0;window.wpseCreateVariationsLoop=beAjaxLoop({totalCalls:Math.ceil(s/parseInt(u)),url:i.attr("action"),method:i.attr("method"),data:a,onSuccess:function(e,t){if(loading_ajax({estado:!1}),!0===e.success||e.data||(e={data:{message:vgse_editor_settings.texts.http_error_try_now},success:!1}),!e.success)return jQuery(c).append("<p>"+e.data.message+"</p>"),confirm(e.data.message)?(t.current=0,c.scrollTop(c[0].scrollHeight),!0):(jQuery(c).append(vgse_editor_settings.texts.saving_stop_error),c.scrollTop(c[0].scrollHeight),d&&n&&(jQuery("body").data("be-filters",""),jQuery("body").data("be-filters",n)),!1);e.data.force_complete&&(t.current=t.totalCalls),e.data.deleted.length&&vgseRemoveRowFromSheetByID(e.data.deleted),l.go(t.current/t.totalCalls*100);var a=parseInt(u)*t.current>s?s:parseInt(u)*t.current,r=(r=v.replace("{updated}",a)).replace("{total}",s);return jQuery(c).empty().append("<p>"+r+"</p>"),_+=e.data.variations_count,t.current===t.totalCalls&&("copy"===o.find('input[name="vgse_variation_tool"]').val()?function(e,r,t){loading_ajax({estado:!1});var i=t.find(".response"),o=t.parents("form");o.find("#be-variations-nanobar-container").remove(),i.before('<div id="be-variations-nanobar-container" />');var a={classname:"be-progress-bar",target:document.getElementById("be-variations-nanobar-container")},n=new Nanobar(a);n.go(1);var s=vgse_editor_settings.wc_products_variation_copy_batch_size;s<1&&(s=1);var d=0;window.wpseCopyVariationsQueueLoop=beAjaxLoop({totalCalls:Math.ceil(r/parseInt(s)),url:t.parents("form").attr("action"),method:t.parents("form").attr("method"),data:{action:"vgse_process_copy_variations_queue",nonce:vgse_editor_settings.nonce,wpse_job_id:e},onSuccess:function(e,t){if(loading_ajax({estado:!1}),!0===e.success||e.data||(e={data:{message:vgse_editor_settings.texts.http_error_try_now},success:!1}),!e.success)return jQuery(i).append("<p>"+e.data.message+"</p>"),confirm(e.data.message)?(t.current--,i.scrollTop(i[0].scrollHeight),!0):(jQuery(i).append(vgse_editor_settings.texts.saving_stop_error),i.scrollTop(i[0].scrollHeight),!1);e.data.force_complete&&(t.current=t.totalCalls),n.go(t.current/t.totalCalls*100),d+=e.data.created;var a=(a=e.data.message.replace("{total_created}",d)).replace("{total}",r);return jQuery(i).empty().append("<p>"+a+"</p>"),t.current===t.totalCalls&&(jQuery(i).append("<p>"+vgse_editor_settings.texts.everything_saved+"</p>"),loading_ajax({estado:!1}),notification({mensaje:vgse_editor_settings.texts.everything_saved}),i.find(".remodal-cancel").removeClass("hidden"),o.find("#be-variations-nanobar-container").remove()),setTimeout(function(){i.scrollTop(i[0].scrollHeight)},600),!0}})}(i.find('input[name="wpse_job_id"]').val(),_,o):(jQuery(c).append("<p>"+vgse_editor_settings.texts.everything_saved+"</p>"),loading_ajax({estado:!1}),notification({mensaje:vgse_editor_settings.texts.everything_saved}),c.find(".remodal-cancel").removeClass("hidden"),i.find("#be-variations-nanobar-container").remove()),d&&n&&(jQuery("body").data("be-filters",""),jQuery("body").data("be-filters",n))),setTimeout(function(){c.scrollTop(c[0].scrollHeight)},600),!0}})}else loading_ajax({estado:!0}),jQuery.ajax({url:i.attr("action"),method:i.attr("method"),data:a}).done(function(e){loading_ajax({estado:!1}),e.success?(1<e.data.data.length&&vgAddRowsToSheet(e.data.data,"prepend",!0),e.data.deleted.length&&vgseRemoveRowFromSheetByID(e.data.deleted),notification({mensaje:e.data.message}),jQuery(window).scrollTop(jQuery(".be-spreadsheet-wrapper").offset().top-jQuery("#vg-header-toolbar").height()-20)):notification({mensaje:e.data.message,tipo:"error",tiempo:6e4}),jQuery(".create-variation-modal").remodal().close()});return!1})}),jQuery(document).ready(function(){jQuery(".vgse-current-filters").on("click",".button",function(e){"wc_display_variations"!==jQuery(this).data("filter-key")&&!jQuery(this).hasClass("remove-all-filters")||jQuery("#display-variations").prop("checked",!jQuery("#display-variations").prop("checked")).trigger("change")}),jQuery('.vgse-current-filters .button[data-filter-key="wc_display_variations"]').length&&jQuery("#display-variations").prop("checked",!0).trigger("change"),jQuery('.vgse-current-filters .button[data-filter-key="search_variations"]').length&&jQuery('#be-filters input[name="search_variations"]').prop("checked",!0).trigger("change");var e=jQuery('.wpse-advanced-filters-field-selector option[value*="attribute_"]'),t=e.clone();e.remove(),jQuery('#be-filters input[name="search_variations"]').on("change",function(e){e.preventDefault(),jQuery(this).is(":checked")?(jQuery("#display-variations").prop("checked",!0).trigger("change"),jQuery(".wpse-advanced-filters-field-selector").append(t),jQuery(".modal-formula .run-on-variations-field select").is(":visible")||jQuery(".modal-formula .run-on-variations-field select").val("on"),jQuery('.wpse-advanced-filters-field-selector option[value*="attribute_"]').show(),jQuery('.wpse-advanced-filters-field-selector option[value*="attribute_pa_"]').hide()):(jQuery('.wpse-advanced-filters-field-selector option[value*="attribute_"]').hide(),jQuery(".modal-formula .run-on-variations-field select").is(":visible")||jQuery(".modal-formula .run-on-variations-field select").val(""))}),jQuery("#display-variations").on("change",function(e){var t=jQuery(this);t.is(":checked")?jQuery("body").addClass("vg-variations-enabled"):jQuery("body").removeClass("vg-variations-enabled");var a={wc_display_variations:t.is(":checked")?"yes":""};beAddRowsFilter(a)}),jQuery("#display-variations").on("click",function(e){var t=jQuery(this);if(beGetModifiedItems().length){if(t.is(":checked"))var a=vgse_wc_attr_data.texts.variations_on_reload_needed;else a=vgse_wc_attr_data.texts.variations_off_reload_needed;if(!confirm(a))return!0}t.trigger("change"),vgseReloadSpreadsheet()}),jQuery('.vg-toolbar [name="display_all_variations"]').on("click",function(e){jQuery("#display-variations").click()}),jQuery('.vg-toolbar [name="display_selected_products_variations"], .vg-toolbar [name="only_display_selected_products_variations"]').on("click",function(e){var l=vgseGetSelectedIds(),u="only_display_selected_products_variations"===jQuery(this).attr("name");if(!l.length)return alert(vgse_editor_settings.texts.please_select_rows_with_checkboxes),!0;if(u&&(beGetModifiedItems().length&&!confirm(vgse_editor_settings.texts.save_changes_before_we_reload)))return!1;loading_ajax(!0),l.chunk(vgse_editor_settings.posts_per_page).forEach(function(c){jQuery.get(vgse_global_data.ajax_url,{nonce:vgse_editor_settings.nonce,product_ids:c.join(","),action:"vgse_load_variations_per_product",post_type:"product"},function(e){if(loading_ajax(!1),e.data.rows&&e.data.rows.length){var a=[],t=null,r=null;if(e.data.rows.forEach(function(e){"product"===e.post_type?(a[e.ID]=[],t=e.ID):(a[t].push(e),r=e.ID)}),!r)return alert(vgse_editor_settings.texts.variations_not_found_for_selected_products.replace("{ids}",c.join(", "))),!0;var i=hot.getSourceData(),o=[];if(u)o=e.data.rows,window.beOriginalData=jQuery.merge(window.beOriginalData,o),jQuery("body").data("be-filters",""),beAddRowsFilter("post__in="+l.join(","));else{var n=hot.getDataAtProp("ID"),s=0;i.forEach(function(e){if(void 0!==a[e.ID]&&a[e.ID].length){var t=a[e.ID];o.push(e),s++,t.forEach(function(e){n.indexOf(e.ID)<0&&(o.push(e),window.beOriginalData.push(jQuery.extend(!0,{},e)))})}else o.push(e)})}hot.loadData(o),jQuery("body").trigger("vgSheetEditor:afterRowsInsert",[e.data.rows,"append",!1]),vgseUpdateTableWrapperMinHeight();var d=c.length===s?vgse_editor_settings.texts.variations_displayed_successfully_for_selected_products.replace("{parentProductsWithVariationsCount}",s):vgse_editor_settings.texts.variations_displayed_for_selected_products.replace("{parentProductsWithVariationsCount}",s).replace("{parentProductsWithoutVariationsCount}",c.length-s);notification({mensaje:d,tipo:"success",tiempo:8e3})}else alert(vgse_editor_settings.texts.variations_not_found_for_selected_products.replace("{ids}",c.join(", ")))})})}),jQuery(".modal-formula .run-on-variations-field select").on("change",function(){var e=jQuery('#be-filters input[name="search_variations"]');e.prop("checked",!!jQuery(this).val()),e.trigger("change"),jQuery(this).val()?beAddRowsFilter("search_variations=yes"):beAddRowsFilter("search_variations="),window.wpseUpdateBulkEditRowsCount=!0,"current_search"===jQuery(".modal-formula .wpse-select-rows-options").val()&&jQuery("#be-filters").submit()})}),jQuery(document).ready(function(){jQuery("body").on("vgSheetEditor:beforeRowsInsert",function(e,t){if(void 0===t.data.total_inventory_price||void 0===t.data.total_inventory_price)return!0;jQuery("#responseConsole .wc-inventory-totals .item-value").html(t.data.total_inventory_units+" units ("+t.data.total_inventory_price+")")})}),jQuery(document).ready(function(){var i=jQuery(".vgse-variations-tool-selector");i.on("click",function(e){e.preventDefault();var t=jQuery(this).data("target");jQuery(".vgse-variations-tool").hide(),i.removeClass("active"),jQuery(this).addClass("active");var a=jQuery(t);a.show();var r=a.find("select.select2");if(r.data("select2"))try{r.select2("destroy")}catch(e){}vgseInitSelect2(r.filter(function(){return jQuery(this).is(":visible")}))}),jQuery('[name="vgse_variation_manager_source"]').on("change",function(e){var t=jQuery(this).parents(".vgse-variations-tool"),a=jQuery(this).val();t.find(".use-search-query-container").hide(),t.find(".use-search-query-container").find("input:checkbox").prop("checked",!1),"search"===a?(t.find(".use-search-query-container").css("display","block"),t.find(".individual-product-selector").hide(),t.find(".individual-product-selector ~ .select2").hide(),window.vgseBackToVariationsTool=!0,jQuery('[name="run_filters"]').first().click()):"all"===a?(t.find(".use-search-query-container").hide(),t.find(".individual-product-selector").hide(),t.find(".use-search-query-container").find("input:checkbox").prop("checked",!0),t.find(".individual-product-selector ~ .select2").hide(),t.hasClass("vgse-create-variations")?(jQuery("body").data("be-filters",{"apply_to[]":"product_type--variable"}),vgseReloadSpreadsheet(!0)):vgseRemoveAllFilters()):("individual"===a&&(t.find(".individual-product-selector").show(),t.find(".individual-product-selector ~ .select2").show()),a||(t.find(".individual-product-selector").hide(),t.find(".individual-product-selector ~ .select2").hide()));var r=t.find("select.select2");vgseInitSelect2(r.filter(function(){return jQuery(this).is(":visible")}))}),jQuery(document).on("closed",'[data-remodal-id="modal-filters"]',function(){void 0!==window.vgseBackToVariationsTool&&window.vgseBackToVariationsTool&&(window.vgseBackToVariationsTool=!1,jQuery('[data-remodal-target="create-variation-modal"]').first().click())}),jQuery(".vgse-variations-tool .show-advanced-options").on("change",function(){jQuery(this).is(":checked")?jQuery(".vgse-variations-tool .advanced-options").show():jQuery(".vgse-variations-tool .advanced-options").hide()}),jQuery(document).on("closed",'[data-remodal-id="create-variation-modal"]',function(){jQuery('[data-remodal-id="create-variation-modal"]').find(".response").empty(),jQuery('[data-remodal-id="create-variation-modal"]').find("#be-variations-nanobar-container").remove();var e=jQuery(".vgse-variations-tool.vgse-copy-variations");"copy"===e.find('input[name="vgse_variation_tool"]').val()&&e.data("isPaginatedIndividualProductsOperation")&&e.find('[name="vgse_variation_manager_source"]').val("individual").trigger("change"),window.wpseCreateVariationsLoop&&window.wpseCreateVariationsLoop.pause(),window.wpseCopyVariationsQueueLoop&&window.wpseCopyVariationsQueueLoop.pause()})}),jQuery(document).ready(function(){if("undefined"==typeof hot||!jQuery(".create_variation-container").length)return!0;var e=hot.getSettings().contextMenu;void 0===e.items&&(e.items={}),e.items.wc_separator1={name:"---------"},e.items.wpse_create_variations={name:vgse_editor_settings.texts.create_variations,callback:function(e,t,a){if(beGetModifiedItems().length)alert(vgse_editor_settings.texts.save_changes_before_we_reload);else{var o=jQuery(".create-variation-modal .vgse-create-variations").find(".individual-product-selector");o.find("option").prop("selected",!1).trigger("change"),jQuery('select[name="vgse_variation_manager_source"]').val("individual").trigger("change");var n=[];t.forEach(function(e){for(var t=e.start.row>e.end.row?e.end.row:e.start.row,a=e.start.row>e.end.row?e.start.row:e.end.row,r=[],i=t;i<=a;i++)r.push(i);r.forEach(function(e){var t=parseInt(hot.getDataAtRowProp(e,"ID")),a=hot.getDataAtRowProp(e,"post_title"),r="product--"+t;n.push(r),o.find('option[value="'+r+'"]').length||o.append('<option value="'+r+'">'+a+"</option>")})}),o.val(n).trigger("change"),jQuery(".create_variation-container  button").click(),setTimeout(function(){jQuery('.create-variation-modal .vgse-variations-tool-selector[data-target=".vgse-create-variations"]').click()},800)}}},e.items.wpse_copy_variations={name:vgse_editor_settings.texts.copy_variations,callback:function(e,t,a){if(beGetModifiedItems().length)alert(vgse_editor_settings.texts.save_changes_before_we_reload);else{var r=parseInt(hot.getDataAtRowProp(t[0].start.row,"ID")),i=hot.getDataAtRowProp(t[0].start.row,"post_title"),o=jQuery(".create-variation-modal .vgse-copy-variations .vgse-copy-variation-from-product"),n="product--"+r;o.append('<option value="'+n+'">'+i+"</option>"),o.val(n).trigger("change"),jQuery(".create_variation-container  button").click(),setTimeout(function(){jQuery('.create-variation-modal .vgse-variations-tool-selector[data-target=".vgse-copy-variations"]').click()},800)}}},hot.updateSettings({contextMenu:e})});