jQuery(document).ready(function(e){const o=window.pagenow.length?window.pagenow:"";if(window.typenow.length&&window.typenow,"edit-product"===o){let u=!1;e("input#doaction, input#doaction2").on("click",function(o){if(u)return!0;o.preventDefault();let t=e(this),n=t.prev("select").val();if("facebook_include"===n){let o=[];e.each(e('input[name="post[]"]:checked'),function(){o.push(parseInt(e(this).val(),10))}),e.post(facebook_for_woocommerce_products_admin.ajax_url,{action:"facebook_for_woocommerce_set_product_sync_bulk_action_prompt",security:facebook_for_woocommerce_products_admin.set_product_sync_bulk_action_prompt_nonce,toggle:n,products:o},function(o){o&&!o.success?(closeExistingModal(),new e.WCBackboneModal.View({target:"facebook-for-woocommerce-modal",string:o.data})):(u=!0,t.trigger("click"))})}else u=!0,t.trigger("click")})}if("product"===o){function t(e,o){o.find(".enable-if-sync-enabled").prop("disabled",!e)}function n(e,o){e?(o.find("option[value='sync_and_show']").show(),o.prop("original")&&o.val(o.prop("original"))):(o.find("option[value='sync_and_show']").hide(),"sync_and_show"===o.val()&&o.val("sync_and_hide"))}function c(e,o){let t=o.find("#wc_facebook_commerce_enabled"),n=t.prop("original");t.prop("checked",!!e&&n).prop("disabled",!e),t.trigger("change"),t.prop("original",n),o.find("#product-not-ready-notice, #variable-product-not-ready-notice").hide(),r()&&!a()?o.find("#variable-product-not-ready-notice").show():e||o.find("#product-not-ready-notice").show()}function i(){return!!(r()?a():"sync_disabled"!==m.val())&&!!(r()||e("#_regular_price").val()||e("#fb_product_price").val())&&!(!e("#_manage_stock").prop("checked")||!e("#_stock").val())}function a(){let o=e(".js-variable-fb-sync-toggle");return 0===o.length?!!facebook_for_woocommerce_products_admin.is_sync_enabled_for_product:!!o.map((o,t)=>"sync_disabled"!==e(t).val()?t:null).length}function r(){var o=e("select#product-type").val();return!(!o||!o.match(/variable/))}function s(e){e.attr("data-original-value",e.val())}function l(o){return m===o?e("input#post_ID").val():o.closest(".woocommerce_variation").find("input[name^=variable_post_id]").val()}function d(o){p=p.filter(function(e){return e!==o}),e(facebook_for_woocommerce_products_admin.product_removed_from_sync_field_id).val(p.join(","))}let p=[];e("#facebook_options #wc_facebook_commerce_enabled").on("change",function(){let o=e(this).prop("checked");o?e(".wc_facebook_commerce_fields").show():e(".wc_facebook_commerce_fields").hide(),e(".product_attributes").find(".woocommerce_attribute").length?e(".show_if_has_attributes").show():e(".show_if_has_attributes").hide(),e(this).prop("original",o)}).trigger("change");const m=e("#wc_facebook_sync_mode"),g=m.closest(".woocommerce_options_panel");s(m),m.on("change",function(){let e="sync_disabled"!==m.val();t(e,g),e&&d(l(m)),m.prop("original",m.val())}).trigger("change"),e("#_virtual").on("change",function(){n(!e(this).prop("checked"),m)}).trigger("change"),e("input[name=_visibility]").on("change",function(){"hidden"!==e(this).val()&&"search"!==e(this).val()&&"sync_disabled"===m.val()&&m.val("sync_and_show").trigger("change")});const h=e("#woocommerce-product-data");h.on("change","#_regular_price, #_manage_stock, #_stock, #wc_facebook_sync_mode, #fb_product_price",function(o){setTimeout(function(){c(i(),e("#facebook_options"))},1)}),e(".woocommerce_variations").on("change",".js-variable-fb-sync-toggle",function(){let o=e(this),n="sync_disabled"!==o.val();t(n,o.closest(".wc-metabox-content")),c(i(),e("#facebook_options")),n&&d(l(o)),o.prop("original",o.val())}),h.on("woocommerce_variations_loaded",function(){h.find(".js-variable-fb-sync-toggle").each(function(o,n){let c=e(n);t("sync_disabled"!==c.val(),c.closest(".wc-metabox-content")),c.prop("original",c.val()),s(c)}),e(".variable_is_virtual").on("change",function(){const o=e(this).closest(".wc-metabox-content").find(".js-variable-fb-sync-toggle");n(!e(this).prop("checked"),o)}),c(i(),e("#facebook_options"))}),h.on("change",".js-fb-product-image-source",function(){let o=e(this).closest(".woocommerce_options_panel, .wc-metabox-content"),t=e(this).val();o.find(".product-image-source-field").closest(".form-field").hide(),o.find(`.show-if-product-image-source-${t}`).closest(".form-field").show()}),e(".js-fb-product-image-source:checked").trigger("change"),h.on("woocommerce_variations_loaded",function(){e(".js-variable-fb-sync-toggle:visible").trigger("change"),e(".js-fb-product-image-source:checked").trigger("change"),e(".variable_is_virtual:visible").trigger("change")}),e("#facebook_options").on("click","#product-not-ready-notice-open-modal",function(o){o.preventDefault(),closeExistingModal(),new e.WCBackboneModal.View({target:"facebook-for-woocommerce-modal",string:{message:facebook_for_woocommerce_products_admin.product_not_ready_modal_message,buttons:facebook_for_woocommerce_products_admin.product_not_ready_modal_buttons}})}),c(i(),g);const b=e("#open_media_library"),v=e("#fb_product_video_selected_thumbnails"),w=e("#fb_product_video");let k,y=w.val()?w.val().split(",").map(Number):[];function _(){w.val(y.join(","))}function f(e,o){y=y.filter(o=>o!==e),_(),o.remove()}b.on("click",function(o){o.preventDefault(),k||(k=wp.media({title:"Select videos",button:{text:"Save"},library:{type:"video"},multiple:!0}),k.on("open",function(){k.$el.addClass("fb-product-video-media-frame");const e=k.state().get("selection");y.forEach(function(o){const t=wp.media.attachment(o);t.fetch(),e.add(t?[t]:[])})}),k.on("select",function(){!function(o){const t=o.map(e=>e.id),n=y.filter(e=>!t.includes(e)),c=t.filter(e=>!y.includes(e));v.find(".form-field").each(function(){const o=e(this),t=parseInt(o.find("span").data("attachment-id"),10);n.includes(t)&&f(t,o)}),o.each(function(o){if(o=o.toJSON(),c.includes(o.id)&&o.mime&&o.mime.startsWith("video/")){const t=function(o){const t=e("<p>",{class:"form-field video-thumbnail"}),n=e("<img>",{src:o.icon}),c=e("<span>",{text:o.url,"data-attachment-id":o.id}),i=e("<a>",{href:"#",text:"Remove",class:"remove-video"});return i.on("click",function(e){e.preventDefault(),f(o.id,t)}),t.append(n,c,i),t}(o);v.append(t),y.push(o.id)}else o.mime.startsWith("video/")||alert("Please select a valid video file.")}),_()}(k.state().get("selection"))})),k.open()}),v.on("click",".remove-video",function(o){o.preventDefault();const t=e(this);f(t.data("attachment-id"),t.closest(".form-field"))})}});